import json
import os

class Producto:

  def __init__(self, id_producto, nombre, cantidad, precio):
    self.id_producto = id_producto
    self.nombre = nombre
    self.cantidad = cantidad
    self.precio = precio

  def __str__(self):
    return f"{self.nombre}, Cantidad: {self.cantidad}, Precio: ${self.precio}"

  # Convertir el objeto Producto a un diccionario para su almacenamiento en JSON
  def to_dict(self):
    return self.__dict__

class Inventario:

  def __init__(self):
    self.productos = self.cargar_productos()

  # Cargar productos desde un archivo JSON
  def cargar_productos(self):
    try:
      with open('inventario.json', 'r') as f:
        productos_dict = json.load(f)
        return {id_producto: Producto(**datos) for id_producto, datos in productos_dict.items()}
    except FileNotFoundError:
      return {}
    except json.JSONDecodeError:
      print("Error: El archivo de inventario está corrupto.")
      return {}
    except PermissionError:
      print("Error: No se tienen permisos de lectura para el archivo de inventario.")
      return {}

  # Guardar productos en un archivo JSON
  def guardar_productos(self):
    try:
      with open('inventario.json', 'w') as f:
        json.dump({id_producto: producto.to_dict() for id_producto, producto in self.productos.items()}, f)
    except PermissionError:
      print("Error: No se tienen permisos de escritura para el archivo de inventario.")

  def agregar_producto(self, producto):
    if producto.id_producto in self.productos:
      print("Error: Producto ya existe.")
    else:
      self.productos[producto.id_producto] = producto
      self.guardar_productos()

  def eliminar_producto(self, id_producto):
    if id_producto in self.productos:
      del self.productos[id_producto]
      self.guardar_productos()
    else:
      print("Error: Producto no encontrado.")

  def actualizar_producto(self, id_producto, cantidad=None, precio=None):
    if id_producto in self.productos:
      if cantidad is not None:
        self.productos[id_producto].cantidad = cantidad
      if precio is not None:
        self.productos[id_producto].precio = precio
      self.guardar_productos()
    else:
      print("Error: Producto no encontrado.")

  def buscar_producto(self, nombre):
    for producto in self.productos.values():
      if nombre.lower() in producto.nombre.lower():
        print(producto)

  def mostrar_inventario(self):
    for producto in self.productos.values():
      print(producto)

def menu():
  inventario = Inventario()
  while True:
    print("\n1. Agregar Producto\n2. Eliminar Producto\n3. Actualizar Producto\n4. Buscar Producto\n5. Mostrar Inventario\n6. Salir")
    opcion = input("Seleccione una opción: ")
    if opcion == '6':
      break
    elif opcion == '1':
      id_producto = input("Ingrese el ID del producto: ")
      nombre = input("Ingrese el nombre del producto: ")
      cantidad = int(input("Ingrese la cantidad del producto: "))
      precio = float(input("Ingrese el precio del producto: "))
      producto = Producto(id_producto, nombre, cantidad, precio)
      inventario.agregar_producto(producto)
    elif opcion == '2':
      id_producto = input("Ingrese el ID del producto a eliminar: ")
      inventario.eliminar_producto(id_producto)
    elif opcion == '3':
      id_producto = input("Ingrese el ID del producto a actualizar: ")
      cantidad = input("Ingrese la nueva cantidad (dejar en blanco para no cambiar): ")
      precio = input("Ingrese el nuevo precio (dejar en blanco para no cambiar): ")
      cantidad = int(cantidad) if cantidad else None
      precio = float(precio) if precio else None
      inventario.actualizar_producto(id_producto, cantidad, precio)
    elif opcion == '4':
      nombre = input("Ingrese el nombre del producto a buscar: ")
      inventario.buscar_producto(nombre)
    elif opcion == '5':
      inventario.mostrar_inventario()

if __name__ == "__main__":
  menu()
